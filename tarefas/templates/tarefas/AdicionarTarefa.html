{% extends "diaAbertoConf/Home.html" %}

	{% block content %}
    	<div class="mt-3 mx-2 mb-5 pb-5">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb bg-white">
					<li class="breadcrumb-item"><a href="{% url 'diaAbertoConf:index' %}">In√≠cio</a></li>
					<li class="breadcrumb-item"><a href="#">Tarefas</a></li>
					<li class="breadcrumb-item active">Adicionar Tarefa</li>
				</ol>
			</nav>
    	    <div class = "row">
    		    <div class = "col-sm-4 offset-sm-4">
                    <h4 style="text-align:center;">Adicionar Tarefa</h4>
    		    </div>
            </div>
    	    <hr class="mx-5">
    	    <div class = "row">
    		    <div class = "col-sm-6  offset-sm-3">
					<form action = "{% url 'tarefas:createTarefa' %}" method="post">
						{% csrf_token %}
  						<div class="form-group row">
    						<label class="form-check-label col-sm-3"> {{formTarefa.descricao.label}} </label>
    						<div class="col-sm-8">
                                {{formTarefa.descricao}}
    						</div>
  						</div>
  						<div class="form-group row pb-5">
                            <label class="form-check-label col-sm-3"> {{formTarefa.tipoTarefa.label}} </label>
    						<div class="col-sm-8">
                                {{formTarefa.tipoTarefa}}
    						</div>
  						</div>
                        <hr>
						<div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaAtividade.atividade.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaAtividade.atividade}}
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaAtividade.sessaoAtividade.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaAtividade.sessaoAtividade}}
    							</div>
  							</div>
						</div>
						<div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.dia.label}} </label>
    							<div class="col-sm-8">
                        	        <input id="dia" type="date" name="dia" class="form-control date-Set" required min="{{diaAberto.data_inicio}}" max="{{diaAberto.data_fim}}">
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.horario.label}} </label>
    							<div class="col-sm-8">
						      		<input id="horario" type="time" name="horario" class="form-control" required>
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.inscricao.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaTransporte.inscricao}}
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.sessaoAtividade_Origem.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaTransporte.sessaoAtividade_Origem}}
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.origem.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaTransporte.origem}}
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.sessaoAtividade_Destino.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaTransporte.sessaoAtividade_Destino}}
    							</div>
  							</div>
							<div class="form-group row">
                        	    <label class="form-check-label col-sm-3"> {{formTarefaTransporte.destino.label}} </label>
    							<div class="col-sm-8">
                        	        {{formTarefaTransporte.destino}}
    							</div>
  							</div>
						</div>
						<hr>
						<div class="form-group row">
							<div class="col-sm-2">
								<a type="button" class="btn btn-secondary" href="#">Cancelar</a>
							</div>
							<div class="col-sm-2">
								<button type="submit" class="btn btn-primary">Guardar</button>
							</div>
						</div>
					</form>
    		    </div>
    	    </div>
    	</div>
	{% endblock %}

	{% block js %}
	<script type='text/javascript'>	

		function addAtividadeAtual(){
			console.log("Atividade Atual");

			$('select[name=sessaoAtividade_Origem]').find('option').each(function(){
				$(this).remove();
			})

			grupoId = $('select[name=inscricao]').val()
			request_url ='/Tarefas/getSessoes_Inscricao/'+ grupoId
			$.ajax({
				url: request_url,
				dataType: "json",
				success: function(data){
					$.each(data, function(index, text){
						$('select[name=sessaoAtividade_Origem]').append(
							$('<option></option>').val(index).html(text)
						)
					})
				},
			});

		}

		$('select[name=atividade]').change(function(){

			$('select[name=sessaoAtividade]').find('option').each(function(){
				$(this).remove();
			})

    		Atividadeid = $(this).val();
    		request_url = '/Tarefas/getSessoes/' + Atividadeid;
    	    $.ajax({
    	        url: request_url,
				dataType: "json",
    	        success: function(data){
					$.each(data, function(index, text){
						$('select[name=sessaoAtividade]').append(
							$('<option></option>').val(index).html(text)
						)
					})
				},
			});
		})

		$('input[name=dia]').change(function(){
			//console.log("Date was changed");
			$('select[name=inscricao]').find('option').each(function(){
				$(this).remove();
			})

			date = $(this).val();
			//console.log(date)
			request_url = '/Tarefas/getInscricoesByDate/' + date;
			$.ajax({
				url: request_url,
				dataType:"json",
				success: function(data){
					$.each(data, function(index, text){
						$('select[name=inscricao]').append(
							$('<option></option>').val(index).html(text)
						)
					})
					if ($('input[name=horario]').val() && Object.keys(data).length > 0)
						addAtividadeAtual();
				}
			});

		})


		$('select[name=inscricao').change(function(){
			if ($('input[name=horario]').val())
				addAtividadeAtual();			
		})

		$('input[name=horario]').change(function(){
			if ($('select[name=inscricao]').val())
				addAtividadeAtual();
		})

	</script>
	{% endblock %}
